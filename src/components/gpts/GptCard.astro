---
import type { CollectionEntry } from "astro:content";
import BrandLogo from "../BrandLogo.astro";
import { withPrefix, type LangPrefix, type SiteLang } from "../../lib/i18n";
import { getUiStrings } from "../../i18n/strings";

interface Props {
  gpt: CollectionEntry<"gpts">;
  compact?: boolean;
  lang?: SiteLang;
  pathPrefix?: LangPrefix;
}

const { gpt, compact = false, lang = "de", pathPrefix = "" } = Astro.props;
const ui = getUiStrings(lang);
const copy = {
  de: {
    gptIconFallbackPrefix: "Icon von",
    gptSymbolFallbackPrefix: "Owli-AI Symbol fuer"
  },
  en: {
    gptIconFallbackPrefix: "Icon of",
    gptSymbolFallbackPrefix: "Owli-AI symbol for"
  },
  es: {
    gptIconFallbackPrefix: "Icono de",
    gptSymbolFallbackPrefix: "Simbolo de Owli-AI para"
  }
}[lang];
const detailsHref = withPrefix(`/gpts/${gpt.data.slug}`, pathPrefix);
const iconSrc = gpt.data.icon?.src;
const iconAlt = gpt.data.icon?.alt?.trim() || `${copy.gptIconFallbackPrefix} ${gpt.data.name}`;
const iconWidth = gpt.data.icon?.width ?? 64;
const iconHeight = gpt.data.icon?.height ?? 64;
---

<article class="group flex h-full flex-col rounded-2xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md">
  <div class="mb-4 flex items-start justify-between gap-3">
    {
      iconSrc ? (
        <img
          src={iconSrc}
          alt={iconAlt}
          width={iconWidth}
          height={iconHeight}
          class="h-16 w-16 rounded-xl object-contain drop-shadow-sm sm:h-20 sm:w-20"
          loading="lazy"
          decoding="async"
        />
      ) : (
        <BrandLogo
          alt={`${copy.gptSymbolFallbackPrefix} ${gpt.data.name}`}
          width={64}
          height={64}
          className="h-16 w-16 rounded-xl object-contain drop-shadow-sm sm:h-20 sm:w-20"
        />
      )
    }
    <div class="flex flex-wrap justify-end gap-1.5">
      {
        gpt.data.audienceBadges.map((badge) => (
          <span class="badge-platform rounded-full px-2.5 py-1 text-xs font-semibold">{badge}</span>
        ))
      }
    </div>
  </div>

  {
    compact ? (
      <h3 class="text-xl font-semibold leading-tight tracking-tight">{gpt.data.name}</h3>
    ) : (
      <h2 class="text-2xl font-semibold leading-tight tracking-tight">{gpt.data.name}</h2>
    )
  }
  <p class="mt-3 text-sm text-slate-700">{gpt.data.shortDescription}</p>

  <div class="mt-4 flex flex-wrap gap-2">
    <a
      href={gpt.data.link}
      target="_blank"
      rel="noopener noreferrer"
      class="btn-brand inline-flex items-center rounded-full border px-4 py-2 text-sm font-semibold transition"
    >
      {ui.cta.openInChatGpt}
    </a>
    <a
      href={detailsHref}
      class="btn-outline-neutral inline-flex items-center rounded-full border px-4 py-2 text-sm font-semibold transition"
    >
      {ui.cta.viewDetails}
    </a>
  </div>
</article>
