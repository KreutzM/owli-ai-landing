---
import BrandLogo from "./BrandLogo.astro";
import {
  resolveLanguagePath,
  withPrefix,
  type LangPrefix,
  type SiteLang
} from "../lib/i18n";
import { getUiStrings } from "../i18n/strings";

interface Props {
  lang?: SiteLang;
  pathPrefix?: LangPrefix;
}

const { lang = "de", pathPrefix = "" } = Astro.props;
const ui = getUiStrings(lang);

const navItems = [
  { href: "/", label: ui.nav.start },
  { href: "/apps", label: ui.nav.apps },
  { href: "/gpts", label: ui.nav.gpts },
  { href: "/research", label: ui.nav.research },
  { href: "/team", label: ui.nav.team },
  { href: "/partners", label: ui.nav.partner },
  { href: "/privacy", label: ui.nav.privacy },
  { href: "/imprint", label: ui.nav.imprint },
  { href: "/accessibility", label: ui.nav.accessibility }
];

const currentPath = Astro.url.pathname;
const localizedNavItems = navItems.map((item) => ({
  ...item,
  href: withPrefix(item.href, pathPrefix)
}));
const languageOptions = (["de", "en", "es"] as const).map((code) => ({
  code,
  label: code.toUpperCase(),
  href: resolveLanguagePath(currentPath, code)
}));

const isActive = (href: string) => {
  if (href === "/") {
    return currentPath === "/";
  }

  return currentPath === href || currentPath.startsWith(`${href}/`);
};
---

<header class="border-b border-slate-200 bg-white">
  <div class="mx-auto flex max-w-6xl items-center justify-between gap-4 px-4 py-3 sm:px-6 lg:px-8">
    <a
      class="flex items-center gap-2.5 font-semibold tracking-tight"
      href={withPrefix("/", pathPrefix)}
      aria-label={ui.aria.homePage}
    >
      <BrandLogo
        alt="Owli-AI Logo"
        width={36}
        height={36}
        className="h-9 w-9 rounded object-contain"
        priority={true}
      />
      <span class="text-lg">Owli-AI</span>
    </a>

    <nav class="hidden md:block" aria-label={ui.aria.mainNavigation}>
      <ul class="flex items-center gap-3 text-[0.95rem] font-medium">
        {
          localizedNavItems.map((item) => (
            <li>
              <a
                href={item.href}
                class:list={[
                  "rounded-lg border border-transparent px-3 py-1.5 transition",
                  isActive(item.href) ? "nav-active" : "hover:bg-slate-100"
                ]}
                aria-current={isActive(item.href) ? "page" : undefined}
              >
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>

    <nav aria-label={ui.aria.languageSelection} class="hidden md:block">
      <ul class="flex items-center gap-1 rounded-lg border border-slate-200 p-1 text-xs font-semibold">
        {
          languageOptions.map((option) => (
            <li>
              <a
                href={option.href}
                class:list={[
                  "rounded px-2.5 py-1 transition",
                  lang === option.code ? "nav-active" : "hover:bg-slate-100"
                ]}
                aria-current={lang === option.code ? "page" : undefined}
              >
                {option.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>

    <details class="md:hidden">
      <summary class="cursor-pointer rounded border border-slate-300 px-3 py-1 text-sm">{ui.aria.menu}</summary>
      <nav class="absolute right-4 z-20 mt-2 w-52 rounded border border-slate-200 bg-white p-2 shadow" aria-label={ui.aria.mobileNavigation}>
        <ul class="space-y-1 text-sm">
          {
            localizedNavItems.map((item) => (
              <li>
                <a
                  href={item.href}
                  class:list={[
                    "block rounded border border-transparent px-2 py-2 transition",
                    isActive(item.href) ? "nav-active" : "hover:bg-slate-100"
                  ]}
                  aria-current={isActive(item.href) ? "page" : undefined}
                >
                  {item.label}
                </a>
              </li>
            ))
          }
        </ul>
        <div class="mt-2 border-t border-slate-200 pt-2">
          <p class="px-2 text-xs font-semibold uppercase tracking-wide text-slate-600">{ui.aria.language}</p>
          <ul class="mt-1 flex gap-1 px-2">
            {
              languageOptions.map((option) => (
                <li>
                  <a
                    href={option.href}
                    class:list={[
                      "rounded px-2 py-1 text-xs font-semibold transition",
                      lang === option.code ? "nav-active" : "hover:bg-slate-100"
                    ]}
                    aria-current={lang === option.code ? "page" : undefined}
                  >
                    {option.label}
                  </a>
                </li>
              ))
            }
          </ul>
        </div>
      </nav>
    </details>
  </div>
</header>
