---
import type { SiteLang } from "../../lib/i18n";

interface MediaItem {
  src: string;
  avif?: string;
  webp?: string;
  alt: string;
  caption?: string;
  width?: number;
  height?: number;
}

interface Props {
  media: MediaItem[];
  appName: string;
  lang?: SiteLang;
}

const { media, appName, lang = "de" } = Astro.props;
const copy = {
  de: {
    heading: "Einblicke",
    placeholderAltPrefix: "Platzhaltergrafik fuer",
    placeholderCaption: "Medien folgen",
    screenshotFallback: (name: string, index: number) => `${name} Screenshot ${index}`,
    viewFallback: (index: number) => `Ansicht ${index}`
  },
  en: {
    heading: "Media gallery",
    placeholderAltPrefix: "Placeholder graphic for",
    placeholderCaption: "Media coming soon",
    screenshotFallback: (name: string, index: number) => `${name} screenshot ${index}`,
    viewFallback: (index: number) => `View ${index}`
  },
  es: {
    heading: "Galeria de medios",
    placeholderAltPrefix: "Grafico de marcador para",
    placeholderCaption: "Multimedia en preparacion",
    screenshotFallback: (name: string, index: number) => `${name} captura ${index}`,
    viewFallback: (index: number) => `Vista ${index}`
  }
}[lang];
const items =
  media.length > 0
    ? media
    : [
        {
          src: "/brand/owli-ai-logo-placeholder.svg",
          alt: `${copy.placeholderAltPrefix} ${appName}`,
          caption: copy.placeholderCaption
        }
      ];

const ensureAlt = (item: MediaItem, index: number) => item.alt?.trim() || copy.screenshotFallback(appName, index + 1);
const ensureCaption = (item: MediaItem, index: number) => item.caption?.trim() || copy.viewFallback(index + 1);
const isPortrait = (item: MediaItem) => (item.height ?? 0) > (item.width ?? 0);
---

<section aria-labelledby="media-heading" class="space-y-4">
  <h2 id="media-heading" class="text-2xl font-semibold tracking-tight">{copy.heading}</h2>
  <ul class="grid gap-4 sm:grid-cols-2">
    {
      items.map((item, index) => (
        <li class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm">
          <figure>
            <div
              class:list={[
                "flex items-center justify-center bg-slate-50",
                isPortrait(item) ? "h-[22rem] p-2 sm:h-[27rem] sm:p-3" : "h-56 p-3 sm:h-64"
              ]}
            >
              <picture class="flex h-full w-full items-center justify-center">
                {item.avif && <source srcset={item.avif} type="image/avif" />}
                {item.webp && <source srcset={item.webp} type="image/webp" />}
                <img
                  src={item.src}
                  alt={ensureAlt(item, index)}
                  width={item.width ?? 1200}
                  height={item.height ?? 675}
                  class:list={[
                    "rounded-2xl object-contain",
                    isPortrait(item) ? "h-full w-auto" : "h-auto w-full"
                  ]}
                  loading="lazy"
                  decoding="async"
                />
              </picture>
            </div>
            <figcaption class="border-t border-slate-200 px-4 py-3 text-sm text-slate-700">{ensureCaption(item, index)}</figcaption>
          </figure>
        </li>
      ))
    }
  </ul>
</section>
